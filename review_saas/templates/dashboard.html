
{% extends 'base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-md-3"><div class="card"><div class="card-body"><h6>Total Reviews</h6><h3 id="totalReviews">0</h3></div></div></div>
  <div class="col-md-3"><div class="card"><div class="card-body"><h6>Avg Rating</h6><h3 id="avgRating">0</h3></div></div></div>
  <div class="col-md-3"><div class="card"><div class="card-body"><h6>Positive</h6><h3 id="posPct">0%</h3></div></div></div>
  <div class="col-md-3"><div class="card"><div class="card-body"><h6>Negative</h6><h3 id="negPct">0%</h3></div></div></div>
</div>
<div class="row mt-3">
  <div class="col-md-8"><div class="card chart-box"><canvas id="trendChart"></canvas></div></div>
  <div class="col-md-4"><div class="card chart-box"><canvas id="keywordsChart"></canvas></div></div>
</div>
<script>
async function loadDashboard(){
  const cid = {{ company_id }};
  const s = await fetch(`/dashboard/summary/${cid}`).then(r=>r.json());
  document.querySelector('#totalReviews').innerText = s.total_reviews;
  document.querySelector('#avgRating').innerText = s.avg_rating;
  document.querySelector('#posPct').innerText = s.positive_pct + '%';
  document.querySelector('#negPct').innerText = s.negative_pct + '%';
  const t = await fetch(`/dashboard/trend/${cid}`).then(r=>r.json());
  new Chart(document.getElementById('trendChart'), {type:'line', data:{labels:t.map(x=>x.period), datasets:[{label:'Avg Rating', data:t.map(x=>x.avg_rating)}]}});
  const k = await fetch(`/dashboard/keywords/${cid}`).then(r=>r.json());
  new Chart(document.getElementById('keywordsChart'), {type:'bar', data:{labels:k.map(x=>x.keyword), datasets:[{label:'Count', data:k.map(x=>x.count)}]}});
}
loadDashboard();
</script>
{% endblock %}
