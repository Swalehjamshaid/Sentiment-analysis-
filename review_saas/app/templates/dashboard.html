<!-- FILE: review_saas/app/templates/dashboard.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
<meta charset="UTF-8">
<title>Review Intelligence ‚Ä¢ Executive Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>

<style>
  :root {
    --primary: #6366f1;
    --primary-soft: #818cf8;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --neutral: #6b7280;
    --bg: #f8fafc;
    --card-bg: #ffffff;
    --border: #e2e8f0;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --radius: 16px;
    --transition: all 0.25s ease;
  }
  [data-bs-theme="dark"] {
    --bg: #0f172a;
    --card-bg: #1e293b;
    --border: #334155;
    --text: #e2e8f0;
    --neutral: #94a3b8;
  }
  body {
    background: var(--bg);
    font-family: system-ui, sans-serif;
    padding-bottom: 4rem;
    color: var(--text, #0f172a);
  }
  .navbar { background: linear-gradient(135deg, #4f46e5, #7c3aed); box-shadow: 0 2px 12px rgba(0,0,0,0.15);}
  .card { background: var(--card-bg); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); transition: var(--transition);}
  .card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.12);}
  .metric { font-size: 2.8rem; font-weight: 700; color: var(--primary); transition: 0.3s; }
  .chart-wrap { position: relative; height: 320px; }
  .badge-risk-low { background: var(--success); color:white;}
  .badge-risk-medium { background: var(--warning); color:black;}
  .badge-risk-high { background: var(--danger); color:white;}
  .attr-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:1rem;}
  .rec-item { border-left: 4px solid var(--primary); background: rgba(99,102,241,0.03); padding:1rem; border-radius:10px; margin-bottom:1rem; animation: fadeIn 1s ease forwards; opacity:0;}
  @keyframes fadeIn { 0% {opacity:0; transform:translateY(10px);} 100% {opacity:1; transform:translateY(0);} }
  .theme-toggle { background:none; border:none; font-size:1.3rem; cursor:pointer; color:white;}
</style>
</head>
<body>

<nav class="navbar navbar-dark p-3">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <span class="navbar-brand fs-4 fw-semibold">Review Intelligence ‚Ä¢ Executive</span>
    <div class="d-flex gap-3 align-items-center">
      <button class="theme-toggle" title="Toggle theme" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
      </button>
      <button class="btn btn-light btn-sm fw-semibold" data-bs-toggle="modal" data-bs-target="#addCompanyModal">
        <i class="fas fa-plus me-1"></i> Add Company
      </button>
    </div>
  </div>
</nav>

<div class="container py-4">

  <!-- Company Selector & Controls -->
  <div class="card p-4 mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-medium">Company</label>
        <select id="companySelect" class="form-select"></select>
      </div>
      <div class="col-md-4">
        <label class="form-label fw-medium">Date Range</label>
        <div class="input-group">
          <input type="date" id="startDate" class="form-control">
          <span class="input-group-text">‚Üí</span>
          <input type="date" id="endDate" class="form-control">
        </div>
      </div>
      <div class="col-md-4 text-md-end d-flex flex-wrap gap-2 justify-content-md-end">
        <button class="btn btn-outline-secondary" onclick="applyDateRange()">Apply</button>
        <button class="btn btn-outline-info" onclick="fetchGoogleDetails()">Google Details</button>
        <button id="btnSync" class="btn btn-primary position-relative" onclick="syncReviews()">
          <span class="sync-label">Sync Reviews</span>
          <span class="spinner-border spinner-border-sm position-absolute top-50 end-0 translate-middle-y me-3 d-none" role="status"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- AI Insight Section -->
  <div class="row g-3 mb-4">
    <div class="col-lg-6">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">üß† AI-Generated Insights</h5>
        <p id="aiInsights" class="text-muted mt-2">Select a company to generate real AI recommendations...</p>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">üìä ML Revenue Prediction</h5>
        <div class="chart-wrap">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Metrics -->
  <div class="row g-3 mb-4">
    <div class="col-md-3 col-sm-6">
      <div class="card p-4 text-center">
        <div class="text-muted small fw-medium mb-1">TOTAL REVIEWS</div>
        <div id="metricTotal" class="metric">‚Äî</div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6">
      <div class="card p-4 text-center">
        <div class="text-muted small fw-medium mb-1">AVG RATING</div>
        <div id="metricAvg" class="metric">‚Äî</div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6">
      <div class="card p-4 text-center">
        <div class="text-muted small fw-medium mb-1">RISK SCORE</div>
        <div id="metricRisk" class="metric">‚Äî</div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6">
      <div class="card p-4 text-center">
        <div class="text-muted small fw-medium mb-1">RISK LEVEL</div>
        <span id="riskBadge" class="badge fs-5 px-4 py-2 mt-2 badge-risk-low">‚Äî</span>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row g-3 mb-4">
    <div class="col-lg-8">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">Rating Trend</h5>
        <div class="chart-wrap">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">Sentiment Breakdown</h5>
        <div class="chart-wrap">
          <canvas id="sentimentChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- SaaS Architecture & Checklist -->
  <div class="row g-3 mb-4">
    <div class="col-lg-6">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">üè¢ Multi-tenant SaaS Architecture</h5>
        <ul>
          <li>Separate database schema per company</li>
          <li>Role-based access control</li>
          <li>Cloud-first deployment</li>
          <li>High availability & auto-scaling</li>
        </ul>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card p-4 h-100">
        <h5 class="fw-semibold">üöÄ Production Deployment Checklist</h5>
        <ul>
          <li>‚úÖ Database backups configured</li>
          <li>‚úÖ Logging & monitoring active</li>
          <li>‚úÖ API keys & environment variables secured</li>
          <li>‚úÖ Load balancing & scaling verified</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- AI Recommendations -->
  <div class="card p-4 mb-4">
    <h5 class="fw-semibold">AI-Powered Action Recommendations</h5>
    <div id="recommendations" class="mt-3"></div>
  </div>

</div>

<script>
const $ = id => document.getElementById(id);

// Toggle dark/light theme
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-bs-theme') === 'dark';
  html.setAttribute('data-bs-theme', isDark ? 'light' : 'dark');
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
  const icon = document.querySelector('.theme-toggle i');
  icon.className = isDark ? 'fas fa-moon' : 'fas fa-sun';
}
(function initTheme() {
  const saved = localStorage.getItem('theme');
  if(saved==='dark'||(!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) toggleTheme();
})();

// Animations
anime({
  targets: '.metric',
  scale:[0.8,1],
  duration:1500,
  easing:'easeOutElastic(1, .6)',
  delay: anime.stagger(200)
});

// Charts
let trendChart, sentimentChart, revenueChart;
function initCharts(){
  trendChart = new Chart($('#trendChart'), { type:'line', data:{labels:[], datasets:[{label:'Rating', data:[], borderColor:'#6366f1', backgroundColor:'rgba(99,102,241,0.2)'}]}, options:{responsive:true}});
  sentimentChart = new Chart($('#sentimentChart'), { type:'doughnut', data:{labels:['Positive','Neutral','Negative'], datasets:[{data:[0,0,0], backgroundColor:['#10b981','#f59e0b','#ef4444']}]}, options:{responsive:true}});
  revenueChart = new Chart($('#revenueChart'), { type:'bar', data:{labels:['Jan','Feb','Mar','Apr','May'], datasets:[{label:'Predicted Revenue', data:[0,0,0,0,0], backgroundColor:'#6366f1'}]}, options:{responsive:true}});
}

// Load on page ready
document.addEventListener('DOMContentLoaded', async () => { 
  initCharts(); 
  // Call your backend endpoints to load company list, AI insights, and metrics
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
