
{% extends 'base.html' %}
{% block content %}
  <h3>Login</h3>
  <form id="loginForm" class="row g-2">
    <div class="col-md-4"><input class="form-control" name="email" type="email" placeholder="Email" required></div>
    <div class="col-md-4"><input class="form-control" name="password" type="password" placeholder="Password" required></div>
    <div class="col-md-4"><input class="form-control" name="totp" placeholder="2FA code (if enabled)"></div>
    <div class="col-12"><button class="btn btn-primary" type="button" onclick="login()">Login</button></div>
  </form>
  <script>
    async function login(){
      const fd = new FormData(document.getElementById('loginForm'));
      const params = new URLSearchParams({email: fd.get('email'), password: fd.get('password'), totp: fd.get('totp')});
      const r = await fetch('/auth/login?'+params.toString(), {method:'POST'});
      const j = await r.json();
      if(j.access_token){ localStorage.setItem('token', j.access_token); alert('Logged in'); }
      else{ alert(JSON.stringify(j)); }
    }
  </script>
{% endblock %}
